## TLS Blocking Measurements

Transport Layer Security ([TLS](https://tools.ietf.org/html/rfc5246)) is a cryptographic protocol that provides communication with end-to-end security with guarantees of confidentiality and authenticity, which is popularly used for encrypting web traffic as done in [HTTPS](https://en.wikipedia.org/wiki/HTTPS). The [Server Name Indication](https://en.wikipedia.org/wiki/Server_Name_Indication) (SNI), defined first in [RFC 6066](https://tools.ietf.org/html/rfc6066), is an extension to TLS that facilitates multiplexing, i.e. the hosting of multiple HTTPS websites on the same server. In other words, the SNI gives content providers the opportunity to host a variety of websites under the same IP address. For example, the `216.58.209.36` IP (belonging to Google) allows accessing both `www.google.com` and `www.youtube.com` using HTTPS, depending on the SNI being used. When a client wants to establish a secure connection, it fills in the SNI with the hostname of the website it wants to connect to.

Unfortunately, the SNI travels on the network in cleartext, even though there are [experimental efforts](https://blog.cloudflare.com/encrypted-sni/) to work around this technical limitation. Thus, network operators can use [deep packet inspection](https://en.wikipedia.org/wiki/Deep_packet_inspection) to track the websites someone is visiting, and also to filter traffic based on the SNI. The use of SNI-based blocking filtering in state-directed web censorship is being [increasingly recorded](https://tools.ietf.org/html/draft-irtf-pearg-censorship-02). In 2019, the use of SNI filtering was documented in [China](https://www.usenix.org/system/files/foci19-paper_chai_0.pdf) and [South Korea](https://www.newamerica.org/cybersecurity-initiative/c2b/c2b-log/analysis-south-koreas-sni-monitoring/); OONI reported on the SNI based filtering [of Wikipedia in Venezuela](https://ooni.org/post/venezuela-blocking-wikipedia-and-social-media-2019/#blocking-of-wikipedia) and [China](https://ooni.org/post/2019-china-wikipedia-blocking/), as well as of [Facebook live-streaming in Jordan](https://ooni.org/post/jordan-measuring-facebook-interference/); and CIS has earlier [documented](https://cis-india.org/internet-governance/blog/reliance-jio-is-using-sni-inspection-to-block-websites) the use of this technique by Reliance Jio, the [most popular ISP](https://www.statista.com/statistics/639514/internet-subscribers-by-service-providers-india/) in India.

Therefore, researchers in the internet freedom community have started proposing and implementing techniques to measure SNI-based blocking. As part of their research on the blocking practices of Indian ISPs, CIS [proposed](https://cis-india.org/internet-governance/blog/reliance-jio-is-using-sni-inspection-to-block-websites) a methodology to detect SNI blocking. Around the same time, researchers at Jigsaw [proposed](https://github.com/Jigsaw-Code/net-analysis/blob/master/netanalysis/blocktest/measure.sh) improvements in detecting domain blocking, which also included SNI blocking measurements. OONI later [implemented](https://github.com/ooni/probe-engine/pull/298) and [successfully tested on the field](https://ooni.org/post/2020-iran-sni-blocking/) SNI blocking measurements based on Jigsaw’s methodology.

At their core, these methodologies detect SNI-based blocking by connecting to an unrelated host that is not blocked (e.g. `example.com`), and checking whether it is possible to successfully complete a TLS handshake even if the SNI is filled with a hostname that is potentially blocked (e.g. `pornhub.com` in India). The rationale of this technique is to measure whether there is a specific filtering rule in the network blocking of a given SNI.

A recent [report published by the Magma project](https://blog.magma.lavafeld.org/post/women-on-web-blocking/), however, shows that there are other ways of blocking TLS that are not detected by this measurement methodology. In particular, they showed that TLS connections to [www.womenonweb.org](http://www.womenonweb.org/) were being blocked, but the SNI blocking measurement methodology did not detect it. TLS blocking, in fact, only occurred when the SNI was equal to `www.womenonweb.org` *and* the IP address was the one of `www.womenonweb.org`.

Thus, OONI wrote an [experimental implementation](https://github.com/bassosimone/aladdin) based on [the new Go engine](https://github.com/ooni/probe-engine) that was performing two experiments. The first experiment connected to `www.example.org` using the `www.womenonweb.org` SNI. The second experiment, instead, connected directly to the IP address used by `www.womenonweb.org`. The [results](https://ooni.org/post/2020-engine-evaluation-spain/) confirmed the findings of the Magma project’s blog post, and sparked additional curiosity on whether using the same methodology in other contexts (e.g. India) could reveal more forms of blocking. A measurement campaign run by OONI while we were researching this report [documented](https://ooni.org/post/2020-iran-dot/) cases of TLS blocking solely based on the endpoint being used for DNS over TLS connections in Iran. Specifically, OONI found cases where the TLS handshake with `1.1.1.1:853` was blocked regardless of the SNI.